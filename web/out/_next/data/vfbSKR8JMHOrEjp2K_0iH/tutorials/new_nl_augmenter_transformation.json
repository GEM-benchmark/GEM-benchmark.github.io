{"pageProps":{"taskData":{"contentHtml":"<p>This tutorial will demonstrate how to add a new transformation process to the NL-Augmenter library, which researchers can then use to generate new augmented datasets.\nWe will not cover using filters in this tutorial. If you are interested in using filters, check out the tutorial <a href=\"https://github.com/GEM-benchmark/GEM-benchmark.github.io/blob/main/web/data/notebooks/GEM_Hackathon_2021_filters_tutorial.ipynb\">here</a>.</p>\n<h2 id=\"using-transformations\">Using transformations</h2>\n<p>A transformation is represented as a python class.\nTo use a transformation, instantiate an instance of the transformation class and call it via <code>transformation.generate</code>.\nSee the code snippet below for an example.\nNote that most transformations have unique parameters and <code>generate</code> signatures.\nPlease refer to the README and code of the specific transformation you're interested in using for details.\nYou can find a full list of transformations <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/tree/main/transformations\">here</a>.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-keyword\">from</span> transformations.butter_fingers_perturbation <span class=\"hljs-keyword\">import</span> ButterFingersPerturbation\ntransform = ButterFingersPerturbation(prob=<span class=\"hljs-number\">0.2</span>)\ncorpus = [<span class=\"hljs-string\">'This is the first sentence.'</span>, <span class=\"hljs-string\">'This is the second sentence.'</span>]\n<span class=\"hljs-comment\"># transformations return a list </span>\ntransformed_corpus = [transform.generate(sentence)[<span class=\"hljs-number\">0</span>] <span class=\"hljs-keyword\">for</span> sentence <span class=\"hljs-keyword\">in</span> corpus]</code></pre>\n<p>Currently, transformations <em>do not</em> support batch mode, so you will need to pass your sentences into <code>transform.generate</code> individually.\nAfter transforming your corpus, save your data in the preferred format (ideally <code>json</code> or <code>jsonlines</code>).\nThen follow <a href=\"https://gem-benchmark.com/tutorials/new_data_loader\">this tutorial</a> to add your dataset to GEM.</p>\n<h2 id=\"adding-transformations\">Adding transformations</h2>\n<h3 id=\"preliminaries\">Preliminaries</h3>\n<h4 id=\"check-for-novelty\">Check for novelty</h4>\n<p>First step, and probably the most important one, is to carefully read through the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/tree/main/transformations\">list of existing transformations</a>, making sure that no one has already covered the ground you’re proposing. There are dozens of existing systems and many more that are under review, so why duplicate existing work?</p>\n<p>Make sure to check the <strong>transformations</strong> subdirectory in the project repo, as well as the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/pulls\">list of pull requests</a>.</p>\n<h4 id=\"check-the-documentation\">Check the documentation</h4>\n<p>So, you’re certain that your contribution will be novel. Now, the next step is to go to the project repo and carefully read through the documentation. Most important for our purposes are the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/README.md\">main readme document</a>, plus the readmes for the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/interfaces/README.md\"><strong>interfaces</strong></a> and <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/evaluation/README.md\"><strong>evaluation</strong></a> directories.</p>\n<p>Reading these will give you a solid understanding of the rest of the steps we’re going to cover.</p>\n<h3 id=\"setup\">Setup</h3>\n<h4 id=\"fork-the-project-repo\">Fork the project repo</h4>\n<p>Once you’re clear on the documentation, go ahead and fork the repository. New transformations should be submitted as pull requests to the main NL-Augmenter repo.</p>\n<a href=\"https://docs.github.com/en/github/getting-started-with-github/fork-a-repo\">\n<div style=\"text-align:center\"><img src=\"https://docs.github.com/assets/images/help/repository/fork_button.jpg\" alt=\"fork button\" width=\"500\"/></div>\n</a>\n<p>Clone to your machine, and create a new branch to work in.</p>\n<pre><code class=\"hljs language-bash\">git <span class=\"hljs-built_in\">clone</span> <span class=\"hljs-variable\">$PATH_TO_YOUR_FORK</span>\n<span class=\"hljs-built_in\">cd</span> NL-Augmenter\ngit checkout -b new_transformation</code></pre>\n<h4 id=\"copy-an-existing-transformation-as-a-base\">Copy an existing transformation as a base</h4>\n<p>We’re going to start creating our own transformation by copying an existing simple example.</p>\n<pre><code class=\"hljs language-bash\"><span class=\"hljs-built_in\">cd</span> transformations/\ncp -r butter_fingers_perturbation new_transformation\n<span class=\"hljs-built_in\">cd</span> new_transformation</code></pre>\n<h3 id=\"create-your-transformation\">Create your transformation</h3>\n<h4 id=\"update-the-existing-class-info\">Update the existing class info</h4>\n<p>Open the <code>transformation.py</code> file in your editor of choice. Make sure to rename the class to a name that describes your transformation.</p>\n<p>The first thing to define is <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/interfaces/README.md\">what kind of interface</a> our transformation is going to implement, which tells us what it should accept as input and return as output. As an example, we could choose to implement the QuestionAnswerOperation, which expects a question as a string, some context as a string, and answers as a list of strings, and returns a transformed version.</p>\n<p>For our purposes, we’ll be implementing the SentenceOperation interface, which expects only a single piece of text as input and output.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">KeyphraseInsertion</span>(<span class=\"hljs-params\">SentenceOperation</span>):</span></code></pre>\n<p>You’ll also need to decide which downstream tasks you think your class can be applied to: here, we’re going to choose text classification as an example.</p>\n<pre><code class=\"hljs language-python\">tasks = [TaskType.TEXT_CLASSIFICATION]</code></pre>\n<p>Pick the languages this transformation can accept as input using ISO codes here. We’ll stick with English as a default.</p>\n<pre><code class=\"hljs language-python\">languages = [<span class=\"hljs-string\">\"en\"</span>]</code></pre>\n<p>The keywords list is important to fill out. This will give reviewers some idea of the purpose of your transformation, as well as the consequences of using it. You can find a full list and explanation in the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/docs/keywords.md\">docs/keywords.md</a> file. I’m going to leave the existing set as they are.</p>\n<pre><code class=\"hljs language-python\">keywords = [<span class=\"hljs-string\">\"morphological\"</span>, <span class=\"hljs-string\">\"noise\"</span>, <span class=\"hljs-string\">\"rule-based\"</span>, <span class=\"hljs-string\">\"high-coverage\"</span>, <span class=\"hljs-string\">\"high-precision\"</span>]</code></pre>\n<h4 id=\"override-the-generate-method\">Override the generate method</h4>\n<p>Now the preliminaries are done, it’s time to create our transformation. We need to override the generate method to carry out our transformation, paying attention to the expected types of the returned values.</p>\n<p>Remember, for SentenceOperations, the type of the output is a list of strings, so that’s what we should provide. You’ll see our sample class includes a max outputs parameter that controls the number of new outputs generated from a single input sequence. It’s recommended that you use the same format to control how many texts are returned from your transformation.</p>\n<p>In our example class, we’re going to insert a keyphrase between every second element in our string.</p>\n<pre><code class=\"hljs language-python\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">__init__</span>(<span class=\"hljs-params\">self, seed=<span class=\"hljs-number\">0</span>, max_outputs=<span class=\"hljs-number\">1</span>, insert_every=<span class=\"hljs-number\">2</span>, keyphrase=<span class=\"hljs-string\">\"kp_test\"</span></span>):</span>\n    <span class=\"hljs-built_in\">super</span>().__init__(seed, max_outputs=max_outputs)\n    self.insert_every = insert_every\n    self.keyphrase = keyphrase\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">generate</span>(<span class=\"hljs-params\">self, sentence: <span class=\"hljs-built_in\">str</span></span>):</span>\n    perturbed_texts = []\n    itertext = [sentence.split()[i:i + self.insert_every] <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span>\n                <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-built_in\">len</span>(sentence.split()), self.insert_every)]\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(self.max_outputs):\n        new_text = [<span class=\"hljs-string\">f\"<span class=\"hljs-subst\">{<span class=\"hljs-string\">' '</span>.join(x)}</span> <span class=\"hljs-subst\">{self.keyphrase}</span>\"</span> <span class=\"hljs-keyword\">for</span> x <span class=\"hljs-keyword\">in</span> itertext]\n        perturbed_texts.append(<span class=\"hljs-string\">' '</span>.join(new_text))\n    <span class=\"hljs-keyword\">return</span> perturbed_texts</code></pre>\n<h4 id=\"add-your-requirements\">Add your requirements</h4>\n<p>If you’ve added any new package requirements, you’re going to need to add them to a <code>requirements.txt</code> in the same directory as your transformation. This helps to keep each transformations’ imports separate.</p>\n<p>For example, lets add sklearn here, just in case.</p>\n<pre><code class=\"hljs language-bash\">scikit-learn==1.0.1</code></pre>\n<h3 id=\"test-your-solution\">Test your solution</h3>\n<p>Now, it’s time to test your solution on some sample data to make sure it works. First, create a test.json file in the same directory as your transformation, and add at least five test cases.</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"type\"</span>: <span class=\"hljs-string\">\"new_transformation\"</span>,\n  <span class=\"hljs-attr\">\"test_cases\"</span>: [\n    {\n      <span class=\"hljs-attr\">\"class\"</span>: <span class=\"hljs-string\">\"KeyphraseInsertion\"</span>,\n      <span class=\"hljs-attr\">\"inputs\"</span>: {\n        <span class=\"hljs-attr\">\"sentence\"</span>: <span class=\"hljs-string\">\"Andrew finally returned the French book to Chris that I bought last week\"</span>\n      },\n      <span class=\"hljs-attr\">\"outputs\"</span>: [{\n        <span class=\"hljs-attr\">\"sentence\"</span>: <span class=\"hljs-string\">\"Andrew finally kp_test returned the kp_test French book kp_test to Chris kp_test that I kp_test bought last kp_test week kp_test\"</span>\n      }]\n    }\n  ]\n}</code></pre>\n<p>Then we’ll use pytest to check how it runs.</p>\n<pre><code class=\"hljs language-bash\">pytest -s --t=new_transformation</code></pre>\n<h3 id=\"finishing-up\">Finishing up</h3>\n<h4 id=\"write-the-readme\">Write the readme</h4>\n<p>Once we’re sure our transformation is producing good results, it’s time to document it. Open up the <code>readme.md</code> document and add all the important details.</p>\n<p>Make sure to include your name and contact details, along with referencing any prior work you rely on. Add an explanation of the purpose of your transformation, plus some discussion of the kind of tasks you think it will benefit, plus any limitations you’ve identified.</p>\n<p>If you think it would be useful, you can check the <a href=\"https://github.com/GEM-benchmark/NL-Augmenter/blob/main/evaluation/README.md\">evaluation documentation</a> for details of how to test your work against benchmark datasets and models, and how to add that to your documentation.</p>\n<h4 id=\"create-your-pull-request\">Create your pull request</h4>\n<p>Finally, you’re ready to submit!</p>\n<p>Commit all your changes to your new branch, then push them back to the origin. The easiest way to create a pull request from your commit is to <a href=\"https://docs.github.com/en/desktop/contributing-and-collaborating-using-github-desktop/working-with-your-remote-repository-on-github-or-github-enterprise/creating-an-issue-or-pull-request\">use the Github website</a>.</p>\n<a href=\"https://docs.github.com/en/github/getting-started-with-github/fork-a-repo\">\n<div style=\"text-align:center\"><img src=\"https://docs.github.com/assets/images/help/desktop/windows-create-pull-request.png\" alt=\"pull request\" width=\"500\"/></div>\n</a>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>And that’s it. NL-Augmenter has an active community of maintainers who will review your request and add your work to the project. In the meantime, others can try out your tranformation by cloning your fork.</p>\n<p>Congratulations on contributing!</p>\n","title":"Using and Adding Transformation to NL-Augmenter","type":"Transformation","background":"This tutorial shows how to use and add your transformation to NL-Augmenter."}},"__N_SSG":true}